# Session 21.02.26 â€“ Was wurde gemacht

## Zusammenfassung

Langer Arbeitstag mit vielen Verbesserungen rund um **Virtueller Rundgang**, **Bilder/Video-Sync** und **Crash-Absicherung**.

---

## 1. Crash-Check (Morgens)

**2 neue Crash-Risiken gefunden und behoben:**
- `GaleriePage`: Mobile-Polling-useEffect fehlte `notInIframe`-Check â†’ startet jetzt nicht mehr in Cursor Preview
- `ScreenshotExportAdmin`: 2Ã— Backup-Reload nach Wiederherstellung mit `window.self===window.top` gesichert

---

## 2. Virtueller Rundgang â€“ Video-Upload

**Problem:** Video wurde als blob-URL nur im State gehalten â†’ nach Reload weg. Keine Statusanzeige.

**Fix:**
- Video wird sofort lokal in `setPageContentGalerie` gespeichert (nicht erst nach GitHub-Upload)
- Statusanzeige direkt unter dem Button (kein blockierender alert mehr)
- Ã¶k2: Video ebenfalls in localStorage gespeichert
- Max-GrÃ¶ÃŸe auf 100 MB erhÃ¶ht

---

## 3. Foto-Button im Virtuellen Rundgang

**Problem:** Nur ein Foto-Button sichtbar, kein Video-Button (wegen `capture="environment"`).

**Fix:**
- `capture="environment"` entfernt â†’ iOS/Android zeigt jetzt normales AuswahlmenÃ¼
- `ðŸ“¸ Foto wÃ¤hlen` + `ðŸ“¹ Video wÃ¤hlen` als zwei separate Buttons
- Buttons auf **Seite 1 UND Seite 2** sichtbar (war vorher nur Seite 2)

---

## 4. Vollbild beim Tippen

**Problem:** Video/Bild blieb klein, kein Vollbild.

**Fix:**
- Tippen auf Video/Bild â†’ schwarzes Vollbild-Modal mit âœ• zum SchlieÃŸen
- Video startet automatisch, `autoPlay`
- â€žRundgang starten"-Button Ã¶ffnet jetzt direkt Vollbild (nicht mehr eigene Seite)

---

## 5. Bilder/Video auf allen GerÃ¤ten sichtbar (wichtigste Erkenntnis des Tages)

**Problem:** localStorage ist gerÃ¤te-spezifisch. Was am Handy gespeichert wird, kommt NIE automatisch am Mac an.

**Fix:**
- Nach GitHub-Upload: Vercel-Pfad (`/img/k2/name.jpg`) im localStorage speichern â€“ nicht Base64
- Beim Lesen: Base64 und blob-URLs automatisch durch Vercel-Pfade ersetzen
- `getGalerieImages`: Vercel-Pfade als letzter Fallback auf allen GerÃ¤ten
- Alle 4 Dateien auf Vercel verfÃ¼gbar: `willkommen.jpg`, `galerie-card.jpg`, `virtual-tour.jpg`, `virtual-tour.mp4`

**Neue Regel:** `.cursor/rules/daten-geraete-sync.mdc` â€“ bei jedem neuen Feature sofort 3 Fragen:
1. Wo wird gespeichert?
2. Wie kommt es auf andere GerÃ¤te?
3. Greift der Fallback auf ALLEN GerÃ¤ten?

---

## 6. Stand-Badge / index.html Timestamp

**Problem:** `index.html` wurde nicht bei jedem `write-build-info.js`-Aufruf aktualisiert (nur bei `--inject-html`). Mac lud nie automatisch neu.

**Fix:**
- `write-build-info.js`: index.html **immer** aktualisieren (Flag entfernt)
- Regex fÃ¼r altes Script-Ersetzen erweitert (erkennt jetzt alle Varianten)

---

## 7. VirtuellerRundgangPage entfernt aus Navigation

â€žRundgang starten"-Button navigierte auf eigene Seite â†’ jetzt direkt Vollbild.

---

## Neue Regeln (`.cursor/rules/`)

| Datei | Inhalt |
|---|---|
| `daten-geraete-sync.mdc` | localStorage vs. Vercel, 3 Fragen bei neuen Features |

---

## Vercel-Dateien (Stand 21.02.26)

| Datei | URL |
|---|---|
| Willkommensbild | `https://k2-galerie.vercel.app/img/k2/willkommen.jpg` |
| Galerie Innenansicht | `https://k2-galerie.vercel.app/img/k2/galerie-card.jpg` |
| Rundgang Vorschau | `https://k2-galerie.vercel.app/img/k2/virtual-tour.jpg` |
| Rundgang Video | `https://k2-galerie.vercel.app/img/k2/virtual-tour.mp4` |

---

## Letzter Build-Stand

**21.02.26 17:53** (letzter Push des Tages)
