---
description: Build-Skripte schreiben nur bei Änderung – weniger Cursor-Reopen
alwaysApply: true
---

# Build-Skripte: Nur schreiben wenn geändert (Cursor-Reopen vermeiden)

## Erfahrung (28.02.26)

**Problem:** Reopen-Meldungen in Cursor wurden immer häufiger (Intervalle kürzer).

**Ursache:** `scripts/write-build-info.js` läuft bei jedem `npm run dev` und hat **bei jedem Lauf** Dateien überschrieben (api/build-info.js, index.html, buildInfo.generated.ts, build-info.json). Cursor meldet „Reopen“, wenn offene Dateien auf der Platte geändert werden → viele Läufe = viele Reopen.

## Regel (unveränderlich)

**Build-Skripte, die bei dev/build laufen, dürfen Dateien nur schreiben, wenn sich der Inhalt tatsächlich geändert hat. Maßstab = Build-Minute (Label), nicht Millisekunde.**

- **buildInfo.generated.ts:** Nur schreiben wenn `existing !== newContent` oder **BUILD_LABEL (Minute)** sich geändert hat. Gleiche Minute → nicht schreiben.
- **build-info.json:** Nur schreiben wenn sich das **Label (Minute)** geändert hat; gleiche Minute → nicht schreiben (nicht nur exakter JSON-Vergleich).
- **api/build-info.js:** Nur schreiben wenn nicht bereits eine return-Zeile mit aktuellem Label vorhanden (Duplikate bereinigen nur bei Bedarf).
- **index.html:** Altes `var b=` auslesen, **Minute** des alten Timestamps mit aktuellem Label vergleichen. Gleiche Minute → **nicht schreiben**. Nur bei neuer Minute Inject-Script ersetzen.

**Zusätzlich (Reopen dauerhaft vermeiden):** `npm run dev` führt **write-build-info.js nicht aus** – nur `vite`. Stand wird **nur** bei `npm run build` geschrieben. package.json: `"dev": "vite"` (ohne write-build-info). **Nicht zurückändern.**

## Bei neuen Build-Skripten

- Vor dem Schreiben: Prüfen ob Ziel-Datei schon den gleichen Inhalt hat (oder bei Zeit-basierten Werten: gleiche „logische“ Einheit, z. B. Minute).
- Nur bei Änderung `fs.writeFileSync` ausführen.

## Kurzfassung

**Immer schreiben = viele Reopen. Nur bei Änderung schreiben = ruhigeres Cursor-Verhalten. Diese Erfahrung gilt für alle Build-Skripte.**
